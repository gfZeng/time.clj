
time util for Clojure(Script)

* Installation
  #+begin_src clojure
  [time "0.4.0"]
  (:require [time.core :as t])
  #+end_src

* Usage
** new Date
   #+begin_src clojure
     ;; current instant
     (t/date)
     (t/date millis-secs)

     ;; copy instant
     (def d (t/date))
     (t/date d)

     ;; copy and set time-zone
     (d/date d :time-zone (t/time-zone "GMT+00:00"))
   #+end_src


**  format
   #+begin_src clojure
     ;; format use default time zone
     (t/format (t/date) "yyyyMMdd HH:mm:ss")

     (def zero-zone (t/time-zone "GMT+00:00"))
     (def d (t/date (t/date) :time-zone zero-zone))
     (t/format d "yyyyMMdd HH:mm:ss") ; format with zero zone
   #+end_src

** floor
   #+begin_src clojure
   ;; yyyy-MM-dd => yyyy-MM-01
   (t/floor (t/date) [1 :month])

   ;; two month as period
   (t/floor (t/date) [2 :month])

   ;; one week as period & sunday is first day (default)
   (t/floor (t/date) [1 :week])

   ;; one week as period & monday is first day
   (t/floor 
     (t/date current-millis :first-day-of-week :monday)
     [1 :week])
   #+end_src

** floor-seq

   #+begin_src clojure
     ;; sunday as first day of week
     (def week-seq
       (t/floor-seq :week (t/date)))

     ;; `[:1 week]` = `:week`
     (def week-seq
       (t/floor-seq [1 :week] (t/date)))

     ;; use zero-zone, monday as first day, reverse traversal
     ;; last 15 week
     (def week-seq
       (->> (t/date current-millis
                    :first-day-of-week :monday
                    :time-zone zero-zone)
            (t/floor-seq [-1 :week])
            (take 15)))

     ;; other periods: `:year`, `:month`, `:day`, `:hour`, `:minute`, `:second`
     ;; all periods support pair format exclude week, eg. `[1 :year]` = `:year`
     (def quarter-seq
       (t/floor-seq
        [15 :minute]
        (t/date current-millss
                :time-zone zero-zone)))
   #+end_src

** plus
   plus is a low level api, floor-seq implements vai `plus` & `floor`, here is an example of reverse traversal with `[-2 :week]` period:
   #+begin_src clojure
     (def double-week-seq
       (iterate #(plus % [-2 :week]) (floor (t/date) :week)))
   #+end_src

** parse
   #+begin_src clojure
     (def zero-zone (t/time-zone "GMT00:00"))
     (t/parse  "20170704" (t/formatter zero-zone "yyyyMMdd"))

     ;; use default zone
     (t/parse  "20170704" "yyyyMMdd")

     ;; more complicated
     (t/parse  "20170704T03:33:27.333" "yyyyMMdd'T'HH:mm:ss.SSS")
   #+end_src

** chime & lightweight cronjob support
   #+begin_src clojure

     (:require [time.chime :as chime]
               [clojure.core.async :as a :refer [<! go-loop]])

     (let [ch (->> (t/date)
                   (t/floor-seq :minute)
                   (chime/chime-ch))]
       (go-loop [ch]
         ;; println at every begining of minutes
         (when-let [p (<! ch)]
           (println p (t/date))
           (recur))))

     (with-chime [ch (->> (t/date)
                          (t/floor-seq :minute)
                          (chime/chime-ch))]
       (println (t/date)))
   #+end_src

